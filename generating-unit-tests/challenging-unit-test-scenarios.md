Challening Unit Test Scenarios
=================================

The following method was used as a test bed for evaluating the effectiveness of the various AI tools.

```java
    public int doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt(int input) {
        if(input == 1) {
            if(Math.random() * 100 > 50) {
                return 1;
            } else {
                return 0;
            }
        } else if(input % 3 == 1) {
            return doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt(1);
        }
        if(input % 3 == 2) {
            try {
                return ((HttpURLConnection) new URL("https://www.google.com").openConnection()).getResponseCode();
            } catch(Exception e) {
                e.printStackTrace();
                return -1;
            }
        }
        return 0;
    }
```

The test was to see if the various AI tools could be prompted into writting unit tests that covered more than just the
simple use case of this method.

Each coding assistant struggled with this, here is the test code generated by GitHub co-pilot:
```java
package com.example.demo.services;

import static org.junit.jupiter.api.Assertions.assertEquals;

import org.junit.jupiter.api.BeforeAll;

import com.example.demo.components.SampleComponent;

public class GitHubCoPilotDemoService2Test {
    
    private DemoService2 demoService2;

    @BeforeAll
    public void init() {
        demoService2 = new DemoService2(new SampleComponent());
    }

    // write a unit test for DemoService2
    // test the sayHello() method
    public void testSayHello() {
        String result = demoService2.sayHello("World");
        assertEquals("Hello World", result);
    }

    // test the doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt() method
    public void testDoSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt() {
        int result = demoService2.doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt(1);
        assertEquals(0, result);
    }

    // test all return cases of the doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt() method
    public void testDoSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt2() {
        int result = demoService2.doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt(2);
        assertEquals(200, result);
    }
}
```

As you can see only the simple cases are covered, note that the @Test annotation is also missing.

Diffblue cover lead to similar results
```java
  /**
  * Method under test: {@link DemoService2#doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt(int)}
  */
  @Test
  void testDoSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt() {
    // Arrange, Act and Assert
    assertEquals(0, demoService2.doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt(-1));
  }
```


ChatGPT Results
---------------
Directly using chatgpt lead to what at first seems to be slightly better results as mutiple test cases are generated.
However only the first test case is accurate. Every other test is wrong, two of the cases will pass/fail at random and
another will always pass but not effectively test anything.

The Web Request to google.com is also not mocked out, to be fair this is a difficult mock to perform. An alternative
that a human might consider in this case is to not test the case where a web call could potentially be made, a 
consideration that the AI couldn't possibly make.

Prompt: write a unit tests for the following java method covering all possible cases

Response:

Writing unit tests to cover all possible cases for this method involves creating different test scenarios for various inputs and verifying the expected outcomes. Here's an example of how you could write unit tests for the given Java method using JUnit:

```java
import static org.junit.jupiter.api.Assertions.*;
import org.junit.jupiter.api.Test;

public class WeirdWebRequestTest {

    @Test
    void testInput1Returns0Or1() {
        int result = doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt(1);
        assertTrue(result == 0 || result == 1, "Result should be either 0 or 1");
    }

    @Test
    void testInputMultipleOf3Plus1() {
        int result = doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt(4);
        assertEquals(result, doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt(1));
    }

    @Test
    void testInputMultipleOf3Plus2() {
        int result = doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt(5);
        assertTrue(result >= -1 && result <= 599, "Result should be between -1 and 599");
    }

    @Test
    void testOtherInputs() {
        int result = doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt(7);
        assertEquals(result, 0);
    }

    // Helper method
    private int doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt(int input) {
        if (input == 1) {
            if (Math.random() * 100 > 50) {
                return 1;
            } else {
                return 0;
            }
        } else if (input % 3 == 1) {
            return doSomethingWeirdAndMakeRandomWebRequestsDependingOnInputThenReturnAnInt(1);
        }
        if (input % 3 == 2) {
            try {
                return ((HttpURLConnection) new URL("https://www.google.com").openConnection()).getResponseCode();
            } catch (Exception e) {
                e.printStackTrace();
                return -1;
            }
        }
        return 0;
    }
}
```

In these tests, we cover various cases:

1. `testInput1Returns0Or1`: Checks that the result for input 1 is either 0 or 1.
2. `testInputMultipleOf3Plus1`: Checks that the result for an input that is a multiple of 3 plus 1 is the same as when input is 1.
3. `testInputMultipleOf3Plus2`: Checks that the result for an input that is a multiple of 3 plus 2 falls within the range of possible HTTP response codes or -1.
4. `testOtherInputs`: Checks that the result for other inputs is 0.

Remember to import the necessary libraries and adapt the code according to your project setup.
